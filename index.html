<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Página de Producto 3D</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f7f7f7;
        }
        .container {
            display: flex;
            width: 90%;
            max-width: 1200px;
            margin: 20px auto;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        .image-section {
            flex: 1;
            padding: 35px;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column; /* Cambiado para alinear en columna */
            justify-content: left;
            align-items: left;
        }

        #product-viewer {

          background-color: #fff;
          transition: width 0.3s ease, height 0.3s ease;
        }
        #small-canvas {

        background-color: #f0f0f0;
        cursor: pointer;
        transition: width 0.3s ease, height 0.3s ease;
        }


        /* Botón en overlay */
        .overlay-button {
            display: none;
            position: absolute;
            padding: 5px 10px;
            background-color: #007bff;
            color: #fff;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: opacity 0.2s ease;
            z-index: 1; /* Asegurarse de que esté por encima del canvas */
        }

        
                /* Clases para intercambiar tamaños */
        .large {
            width: 500px !important;
            height: 500px !important;
        }

        .small {
            width: 100px !important;
            height: 100px !important;
        }
        #viewer-container {
            position: relative;
            display: flex;
            align-items: flex-start;
        }
        
        #image-uploader {
          text-align: center;
          margin-top: 20px;
        }

        .description-section {
            flex: 1;
            padding: 20px;
        }
        .description-section h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        .price {
            font-size: 22px;
            color: #333;
            margin-bottom: 15px;
        }
        .options {
            margin-bottom: 15px;
        }
        .options label {
            display: block;
            margin-bottom: 5px;
        }
        .options select, .quantity-selector input {
            padding: 10px;
            width: 100%;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .quantity-selector {
            margin-bottom: 15px;
        }

        .add-to-cart {
            background-color: #007bff;
            color: #fff;
            padding: 15px;
            text-align: center;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        .add-to-cart:hover {
            background-color: #0056b3;
        }
        .product-description {
            margin-top: 20px;
        }
        .reviews {
            margin-top: 20px;
        }
        .reviews .stars {
            color: #ffc107;
        }
        .recommended-products {
            margin-top: 20px;
        }
        .recommended-products h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        .section {
            padding: 20px;
            border-bottom: 1px solid #ddd;
        }
        /* Clase para mover canvas3D a la derecha */
        .moved {
        left: 150px; /* Ajusta según lo necesario */
        }
        
    </style>
</head>
<body>

<div class="container">
    <div class="image-section">
        <div id="product-viewer" style="width: 500px; height: 500px;"></div> <!-- El visor 3D se carga aquí -->
        <canvas id="small-canvas"></canvas> <!-- El visor 2D se carga aquí -->
          <div class="overlay-button" id="canvas2d-button" style="top: 10px; left: 10px;">Click aquí</div>
        </div>


    <div class="description-section">
        <h1>Nombre del Producto</h1>
        <p class="price">$99.99</p>
        <div class="options">
            <label for="size">Tamaño</label>
            <select id="size">
                <option>Pequeño</option>
                <option>Mediano</option>
                <option>Grande</option>
            </select>
        </div>
        <div class="options">
            <label for="color">Color</label>
            <select id="color">
                <option>Rojo</option>
                <option>Azul</option>
                <option>Negro</option>
            </select>
        </div>
        <div class="quantity-selector">
            <label for="quantity">Cantidad</label>
            <input type="number" id="quantity" min="1" value="1">
        </div>
        <div class="add-to-cart">Añadir al Carrito</div>

        <!-- Input para subir la imagen -->
        <div id="image-uploader">
            <label for="image-input">Selecciona una imagen para aplicar como textura:</label>
            <input type="file" id="image-input" accept="image/*">
        </div>

        <div class="section">
            <label for="part-select">Parte seleccionada:</label>
                <input type="text" id="part-select" readonly>
        </div>

        <div class="reviews">
            <h2>Reseñas de Clientes</h2>
            <p class="stars">★★★★☆</p>
            <p>"Muy buen producto, excelente calidad y precio razonable." - Cliente Satisfecho</p>
        </div>

        <div class="recommended-products">
            <h2>Productos Recomendados</h2>
            <ul>
                <li>Producto 1</li>
                <li>Producto 2</li>
                <li>Producto 3</li>
            </ul>
        </div>
    </div>
</div>

<!-- Three.js Library -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<!-- OrbitControls -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

<!-- OBJ and MTL Loaders -->
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/MTLLoader.js"></script>

<script>
    var scene = new THREE.Scene();
    scene.background = new THREE.Color(0xf7f7f7);

    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 5, 20);
    camera.lookAt(scene.position);

    var renderer = new THREE.WebGLRenderer();
    renderer.setClearColor(0xf7f7f7);
    var container = document.getElementById('product-viewer');
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    var ambientLight = new THREE.AmbientLight(0xffffff, 0.8);
    scene.add(ambientLight);

    var directionalLight = new THREE.DirectionalLight(0xffffff, 1);
    directionalLight.position.set(1, 1, 1).normalize();
    scene.add(directionalLight);

    var controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.update();

    // Crear un Raycaster y un Vector para almacenar la posición del mouse
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

// Función para manejar el clic en el canvas y seleccionar partes
function onCanvasClick(event) {
    const rect = renderer.domElement.getBoundingClientRect();
    mouse.x = ((event.clientX - rect.left) / rect.width) * 2 - 1;
    mouse.y = -((event.clientY - rect.top) / rect.height) * 2 + 1;

    raycaster.setFromCamera(mouse, camera);

    const intersects = raycaster.intersectObjects(object.children, true);

    if (intersects.length > 0) {
        const selectedMesh = intersects[0].object;
        console.log("Parte seleccionada:", selectedMesh.name);

        // Resetear la emisión en todas las partes antes de resaltar la seleccionada
        object.traverse(function (child) {
            if (child instanceof THREE.Mesh) {
                child.material.emissive.set(0x000000); // Apagar resaltado
            }
        });

        // Aplicar resaltado solo a la parte seleccionada
        selectedMesh.material.emissive.set(0x555555); // Resaltar solo la parte seleccionada


    // Agrega un console.log antes de la actualización
    console.log("Antes de actualizar:", document.getElementById("part-select"));

// Asegúrate de que selectedPart tenga un valor válido antes de actualizar el campo de texto
selectedPart = selectedMesh.name; // Asigna el nombre de la parte seleccionada

// Actualizar el campo de texto con el nombre de la parte seleccionada
const partSelect = document.getElementById('part-select');
if (partSelect && selectedPart) {
    partSelect.value = selectedPart;
    console.log("Actualización del campo de texto:", partSelect.value);
} else {
    console.warn("Elemento 'part-select' no encontrado en el DOM o 'selectedPart' no está definido");
}

}
    }

    document.addEventListener('DOMContentLoaded', function() {
    renderer.domElement.addEventListener('click', onCanvasClick);
});



// Agregar el evento de clic al canvas
renderer.domElement.addEventListener('click', onCanvasClick);




    

// Declaración global para el objeto y la parte seleccionada
var object = null;
var selectedPart = null;

// Cargar el archivo MTL y OBJ
var mtlLoader = new THREE.MTLLoader();
mtlLoader.load('Version obj con partes discriminadas3.mtl', function (materials) {
    materials.preload();
    var objLoader = new THREE.OBJLoader();
    objLoader.setMaterials(materials);
    objLoader.load('Version obj con partes discriminadas3.obj', function (loadedObject) {
        object = loadedObject;
        object.position.set(0, 0, 0);
        object.scale.set(0.3, 0.3, 0.3);
        scene.add(object);

    // Clonar el material de cada parte para que sean independientes
    object.traverse(function (child) {
        if (child instanceof THREE.Mesh) {
            child.material = child.material.clone();  // Clonar material
            console.log("Parte cargada:", child.name); // Comprobación en consola
        }
    });
    
    // Llenar el selector de partes
    actualizarSelectorDePartes(object);
  });
});

// Función para llenar el selector de partes automáticamente
function actualizarSelectorDePartes(objeto) {
    const partSelect = document.getElementById('part-select');
    objeto.traverse(function (child) {
        if (child instanceof THREE.Mesh) {
            const option = document.createElement('option');
            option.value = child.name;
            option.textContent = child.name;
            partSelect.appendChild(option);
        }
    });
}

// Evento para seleccionar la parte
document.getElementById('part-select').addEventListener('change', function () {
    selectedPart = this.value;
    console.log(`Parte seleccionada: ${selectedPart}`);
});

// Función para aplicar textura solo cuando el objeto y la parte seleccionada están definidos
function applyTextureToSelectedPart(texture) {
    if (!object || !selectedPart) {
        console.warn("No se puede aplicar la textura. Asegúrate de que el objeto y la parte seleccionada estén definidos.");
        return;
    }

    object.traverse(function (child) {
        if (child instanceof THREE.Mesh && child.name === selectedPart) {
            child.material.map = texture;
            child.material.needsUpdate = true;
            console.log(`Textura aplicada a ${selectedPart}`);
        }
    });
}

// Cargar la imagen y aplicar textura a la parte seleccionada
document.getElementById('image-input').addEventListener('change', function (event) {
    const file = event.target.files[0];
    if (file) {
        const textureLoader = new THREE.TextureLoader();
        const fileURL = URL.createObjectURL(file);
        textureLoader.load(fileURL, function (texture) {
            applyTextureToSelectedPart(texture);
            URL.revokeObjectURL(fileURL); // Liberar memoria
        });
    }
});

// Función de animación
function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
}
animate();

   const canvas3D = document.getElementById('product-viewer');
    const canvas2D = document.getElementById('small-canvas');

    // Función para alternar la posición
    function toggleCanvasPosition() {
        if (canvas3D.classList.contains('moved')) {
            // Remueve el desplazamiento si está aplicado
            canvas3D.classList.remove('moved');
            canvas2D.style.width = '100px';
            canvas2D.style.height = '100px';
        } else {
            // Mueve el canvas3D y expande el canvas2D
            canvas3D.classList.add('moved');
            canvas2D.style.width = '500px';
            canvas2D.style.height = '500px';
        }
    }

 document.addEventListener('DOMContentLoaded', function() {
        const canvas2D = document.getElementById('small-canvas');
        const button = document.getElementById('canvas2d-button');

        // Mostrar el botón al pasar el mouse sobre el canvas2D
        canvas2D.addEventListener('mouseenter', () => {
            button.style.display = 'block';
        });

        // Ocultar el botón al salir del canvas2D
        canvas2D.addEventListener('mouseleave', () => {
            button.style.display = 'none';
        });

        // Acción del botón
        button.addEventListener('click', () => {
            alert('¡Botón en canvas2D presionado!');
        });
    });


    
</script>

</body>
</html>



    
</script>

</body>
</html>
